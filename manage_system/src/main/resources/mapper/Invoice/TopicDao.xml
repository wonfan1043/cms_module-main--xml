<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.inext.manage_system.dao.TopicDao">

    <!-- 主旨取得 by topicId -->
    <select id="selectTopicByTopicId"> 
        SELECT topic_id,
               topic_name,
               create_datetime 
        FROM topic 
        WHERE topic_id = #{topicId}
          AND `delete` = 0
    </select>

    <!-- 主旨取得 by topicName -->
    <select id="selectTopicByTopicName">
        SELECT topic_name 
        FROM topic 
        WHERE topic_name = #{topicName}
          AND `delete` = 0
    </select>

    <!-- 主旨追加 -->
    <insert id="insertTopic">
        INSERT INTO topic 
        (topic_id,
         topic_name, 
         comment, 
         creater, 
         create_datetime,
         updater,
         updateDateTime,
         `delete`) 
        VALUES (#{topic.topicId}, 
                #{topic.topicName}, 
                #{topic.comment}, 
                #{topic.creater}, 
                #{topic.createDateTime},
                NULL,
                NULL,
                #{topic.delete})
    </insert>

    <!-- 主旨編集 by topicId -->
    <update id="updateTopicByTopicId">
        UPDATE topic 
        SET topic_name = #{topic.topicName}, 
            comment = #{topic.comment}, 
            updater = #{topic.updater}, 
            update_datetime = #{topic.updateDateTime} 
        WHERE topic_id = #{topic.topicId} 
    </update>

    <!-- 主旨取得 -->
    <select id="selectTopic">
        SELECT topic_id,
               topic_name,
               create_datetime 
        FROM topic 
        WHERE `delete` = 0
        ORDER BY create_datetime DESC
    </select>
    
    <!-- 主旨取得 by topicName, createDatetime -->
    <select id="selectTopicByTopicNameCreateDatetime">
        SELECT topic_id, 
               topic_name, 
               create_datetime 
        FROM topic 
        WHERE YEAR(create_datetime) = #{searchReq.year} 
          AND MONTH(create_datetime) = #{searchReq.month} 
          AND topic_name LIKE '%#{searchReq.keyword}%' 
          AND `delete` = 0
        ORDER BY create_datetime DESC
    </select>

    <!-- 主旨状態編集 -->
    <update id="updateTopiceStatusByTopicId">
        UPDATE topic 
        SET updater = #{topic.updater}, 
            update_datetime = #{topic.updateDateTime}, 
            `delete` = 1 
        WHERE topic_id = #{topic.topicId}
    </update>

</mapper>